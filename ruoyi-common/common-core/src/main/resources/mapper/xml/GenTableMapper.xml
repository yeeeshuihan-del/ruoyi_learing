<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.yeeeshuihan.common.core.mapper.GenTableMapper">

    <resultMap id="GenTableResultMap" type="com.github.yeeeshuihan.common.core.entity.GenTable">
        <id property="tableName" column="table_name"/>
        <result property="tableComment" column="table_comment"/>
        <collection property="columns" ofType="com.github.yeeeshuihan.common.core.entity.GenColumn">
            <id property="columnName" column="column_name"/>
            <result property="columnComment" column="column_comment"/>
            <result property="javaType" column="data_type"/>
            <result property="isPk" column="is_pk"/>
        </collection>
    </resultMap>

    <select id="selectTableByName" resultMap="GenTableResultMap">
        select
            t1.table_name,
            t1.table_comment,
            t2.column_name,
            t2.column_comment,
            (
                case
                    when LOWER(t2.data_type) in ('char', 'varchar', 'text', 'tinytext', 'mediumtext', 'longtext') then 'String'
                    when LOWER(t2.data_type) in ('tinyint', 'smallint', 'mediumint', 'int') then 'Integer'
                    when LOWER(t2.data_type) = 'bigint' then 'Long'
                    when LOWER(t2.data_type) in ('float', 'double', 'decimal', 'numeric') then 'Double'
                    when LOWER(t2.data_type) in ('datetime', 'timestamp', 'date') then 'Date'
                    when LOWER(t2.data_type) in ('blob', 'tinyblob', 'mediumblob') then 'byte[]'
                    else t2.data_type
                end
            ) as data_type,
            if(t2.column_key='PRI', '1', '0') as is_pk
        from
            information_schema.tables as t1 inner join information_schema.columns as t2 on t1.table_name = t2.table_name
        where t1.table_name = #{tableName}
    </select>
</mapper>
