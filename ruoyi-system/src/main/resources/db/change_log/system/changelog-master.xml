<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

        <changeSet id="create_t_user_2026_01_10" author="yeeeshuihan@github.com">
            <sql>
                CREATE TABLE `t_user` (
                                          `user_id` varchar(32) NOT NULL COMMENT '主键id',
                                          `login_id` varchar(100) DEFAULT NULL COMMENT '登录账号',
                                          `user_name` varchar(100) DEFAULT NULL COMMENT '用户姓名',
                                          `nice_name` varchar(100) DEFAULT NULL COMMENT '昵称',
                                          `user_sex` varchar(5) DEFAULT NULL COMMENT '性别',
                                          `password` varchar(255) DEFAULT NULL COMMENT '密码',
                                          `salt` varchar(45) DEFAULT NULL COMMENT 'md5密码盐',
                                          `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
                                          `mobile_phone` varchar(100) DEFAULT NULL COMMENT '手机号码',
                                          `user_state` varchar(2) DEFAULT '0' COMMENT '用户状态（0 解锁 1 锁定）',
                                          `psw_exp_date` datetime DEFAULT NULL COMMENT '密码有效期',
                                          `psw_update_time` datetime DEFAULT NULL COMMENT '密码更新时间',
                                          `psw_error_num` int(11) DEFAULT '0' COMMENT '密码错误次数',
                                          `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
                                          `valid_tag` char(1) DEFAULT '1' COMMENT '是否有效（0 无效 1 有效） ',
                                          `create_user_id` varchar(32) DEFAULT NULL COMMENT '创建人',
                                          `create_time` datetime DEFAULT NULL COMMENT '创建时间',
                                          `update_user_id` varchar(32) DEFAULT NULL COMMENT '更新人',
                                          `update_time` datetime DEFAULT NULL COMMENT '更新时间',
                                          `depart_code` varchar(40) DEFAULT NULL COMMENT '所属部门编码',
                                          `unit_code` varchar(40) DEFAULT NULL COMMENT '所属公司编码',
                                          PRIMARY KEY (`user_id`) USING BTREE,
                    -- 保留核心索引：登录账号、用户状态、有效性、部门/公司编码（查询高频）
                                          KEY `idx_su_login_id` (`login_id`) USING BTREE,
                                          KEY `idx_su_user_state` (`user_state`) USING BTREE,
                                          KEY `idx_su_valid_tag` (`valid_tag`) USING BTREE,
                                          KEY `idx_su_depart_code` (`depart_code`),
                                          KEY `idx_su_unit_code` (`unit_code`),
                                          KEY `idx_su_mobile_phone` (`mobile_phone`) -- 手机号登录/验证高频，保留
                ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='用户表（精简版）';
            </sql>
        </changeSet>
        <changeSet id="create_t_role_2026_01_17" author="yeeeshuihan@github.com">
            <sql>
                CREATE TABLE `t_role` (
                                          `role_id` varchar(32) NOT NULL COMMENT '角色主键ID',
                                          `role_code` varchar(40) NOT NULL COMMENT '角色编码（唯一，如ADMIN/USER）',
                                          `role_name` varchar(100) NOT NULL COMMENT '角色名称（如超级管理员/普通用户）',
                                          `role_desc` varchar(500) DEFAULT NULL COMMENT '角色描述',
                                          `role_state` varchar(2) DEFAULT '0' COMMENT '角色状态（0 启用 1 禁用）',
                                          `valid_tag` char(1) DEFAULT '1' COMMENT '是否有效（0 无效 1 有效）',
                                          `create_user_id` varchar(32) DEFAULT NULL COMMENT '创建人ID',
                                          `create_time` datetime DEFAULT NULL COMMENT '创建时间',
                                          `update_user_id` varchar(32) DEFAULT NULL COMMENT '更新人ID',
                                          `update_time` datetime DEFAULT NULL COMMENT '更新时间',
                                          PRIMARY KEY (`role_id`) USING BTREE,
                                          UNIQUE KEY `uk_role_code` (`role_code`) USING BTREE, -- 角色编码唯一索引，防止重复
                                          KEY `idx_role_state` (`role_state`) USING BTREE,
                                          KEY `idx_role_valid_tag` (`valid_tag`) USING BTREE
                ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='角色表';
            </sql>
        </changeSet>
        <changeSet id="create_t_user_role_2026_01_17" author="yeeeshuihan@github.com">
            <sql>
                CREATE TABLE `t_user_role` (
                                               `user_role_id` varchar(32) NOT NULL COMMENT '用户角色关联主键ID',
                                               `user_id` varchar(32) NOT NULL COMMENT '用户ID（关联t_user.user_id）',
                                               `role_id` varchar(32) NOT NULL COMMENT '角色ID（关联t_role.role_id）',
                                               `valid_tag` char(1) DEFAULT '1' COMMENT '是否有效（0 无效 1 有效）',
                                               `create_user_id` varchar(32) DEFAULT NULL COMMENT '创建人ID',
                                               `create_time` datetime DEFAULT NULL COMMENT '创建时间',
                                               `update_user_id` varchar(32) DEFAULT NULL COMMENT '更新人ID',
                                               `update_time` datetime DEFAULT NULL COMMENT '更新时间',
                                               PRIMARY KEY (`user_role_id`) USING BTREE,
                                               UNIQUE KEY `uk_user_role` (`user_id`,`role_id`) USING BTREE, -- 唯一索引，防止同一用户重复分配同一角色
                                               KEY `idx_user_role_user_id` (`user_id`) USING BTREE, -- 按用户ID查询角色的索引
                                               KEY `idx_user_role_role_id` (`role_id`) USING BTREE
                ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='用户角色关联表';
            </sql>
        </changeSet>
</databaseChangeLog>
